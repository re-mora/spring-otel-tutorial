Spring Open Telemetry Tutorial
===

# 개요

> Spring Boot 애플리케이션의 상태를 관찰하고 문제를 빠르게 파악하기 위해 **OpenTelemetry 기반의 모니터링 환경**을 구성해요
>
> OpenTelemetry는 애플리케이션에서 발생하는 **Trace**, **Metric**, **Log** 데이터를 한 번에 모아서 관리할 수 있도록 도와주는 **CNCF 표준 Observability
framework**예요
> 수집한 데이터를 Jaeger, Zipkin, Tempo, Prometheus, Grafana 등 다양한 도구로 전달할 수 있고 **원하는 방식으로 시각화하고 분석할 수 있는 유연함**을 제공해요
>
> 또한 특정 클라우드나 기술에 종속되지 않아, **다양한 운영 환경에서도 자유롭게 적용**할 수 있어요

---

# OpenTelemetry 기반 모니터링의 장점

1. **표준화된 API와 OTLP 프로토콜**을 통해 다양한 도구와 손쉽게 연동할 수 있어요
2. **Trace, Metric, Log를 하나의 추적 ID 기반으로 연계**하여 통합 분석이 가능해요
3. **특정 환경이나 기술에 대한 종속 없이**, 클라우드/온프레미스 등 다양한 환경에서 유연하게 적용할 수 있어요

---

## 실습 목표

> - Spring Boot 기반의 상품, 주문 micro service의 흐름을 관찰할 수 있는 Open Telemetry 기반의 환경을 구성해요
> - Trace, Metrics, Log 등의 데이터를 수집하고, 수집된 데이터를 시각화하여 분석할 수 있는 환경을 구성해요

![otel-architecture](https://github.com/user-attachments/assets/1abd6839-6f05-40d5-9980-18466fb627a0)

# 실습 구성 요소

다음과 같은 구성 요소들을 사용해서 전체 모니터링 파이프라인을 구성해보려고 해요

| 구성 요소                                       | 역할 및 장점                                                                                                                                                                                                           |
|---------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **OpenTelemetry <br/> Spring Boot Starter** | - 의존성을 추가하는것 만으로 `내부 메서드, DB 쿼리, 외부 API 호출 흐름, Kafka 메시지` 등 다양한 이벤트에 대한 Trace와 Metric 데이터를 자동으로 수집하고 추적할 수 있어요.<br/> - 코드 변경 없이 분산 추적과 모니터링을 간편하게 구성할 수 있고, 마치 x-ray 처럼 당시 내부에서 어떤 일이 일어나는지 상황을 살펴볼 수 있는 환경을 제공해요 |
| **Jaeger**                                  | - 분산된 환경에서 수집된 Trace 정보를 저장하고 시각적으로 분석할 수 있는 도구예요. <br/> - 요청이 어느 경로로 흘러갔는지, 어디서 지연이 발생했는지를 Span 간 비교 등을 통해 용이하게 확인할 수 있는 환경을 제공해요                                                                                |
| **Zipkin**                                  | - 분산된 환경의 서비스간 호출 관계를  지도 처럼 파악할 수 있도록 보여주는 도구에요. <br/> - 어떤 서비스가 누구와 통신하는지 가시적으로 확인할 수있는 환경을 제공해요                                                                                                                |
| **Tempo**                                   | - Trace 데이터를 오랫동안 보관할 수 있는 저장소에요. <br/> - 가볍고 빠르며 Grafana와 연결하면 별도 UI 없이 추적 결과를 쉽게 확인할 수 있어요                                                                                                                      |
| **Loki**                                    | - 시계열 로그 수집 시스템으로, 로그 데이터를 시간순으로 모아주는 도구에요. <br/> - Trace와 동일한 라벨 구조를 사용해 특정 요청의 로그 추적을 통해 문제 원인을 파악하는데 용이해요                                                                                                      |
| **Prometheus**                              | - 시스템 지표(CPU, 메모리, 요청 수 등)를 수집해 수치로 표현하는 모니터링 도구에요.  <br/> - CPU 사용량, 요청 처리 속도 등 다양한 지표를 주기적으로 수집해서 실시간으로 시스템 상태를 모니터링할 수 있어요                                                                                     |
| **Grafana**                                 | - 수집된 Trace, Log, Metric을 통합 시각화하는 대시보드 도구예요. <br/> - 마치 관제탑 처럼 한 눈에 여러 정보를 쉽게 확인할 수 있는 환경을 제공해요                                                                                                                  |

> - 각 구성 요소를 연동하여 MSA 환경에서도 서비스 간 호출 흐름, 성능 병목, 오류 로그 등을 빠르게 확인하고 파악할 수 있어요
> - 이 구조를 통해 **애플리케이션의 상태와 동작을 통합적으로 분석**할 수 있는 환경을 구성할 수 있어요

# TODO

- [ ] 실습 프로젝트 환경 구성
  - [ ] [OpenTelemetry Spring Boot Starter 의존성 추가](https://opentelemetry.io/docs/zero-code/java/spring-boot-starter/getting-started/)
- [ ] Trace Metrics, Log 등의 데이터 수집 환경 구성을 위한 otel-collector 구성
- [ ] ~~분산 추적을 위한 Jaeger 구성~~
- [ ] ~~분산 환경의 흐름 시각화를 위한 Zipkin 구성~~
- [ ] 시스템 지표 수집을 위한 Prometheus 구성
- [ ] 분산 환경의 Log 수집을 위한 Loki 구성
- [ ] Prometheus + Grafana를 이용한 시스템 모니터링 환경 구성
- [ ] Prometheus + Grafana를 이용한 분산 환경 모니터링 환경 구성
- [ ] 성능 테스트 기반 시스템 지표 확인
